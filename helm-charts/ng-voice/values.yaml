# Default values for ng-voice helm chart

# Namespaces
namespaces:
  database: database
  webServer: web-server

# MySQL Database Configuration (Bitnami MySQL Chart)
mysql:
  # Deploy MySQL in database namespace
  namespaceOverride: database
  
  # Enable MySQL cluster with replication
  architecture: replication
  image:
    registry: docker.io
    repository: bitnamilegacy/mysql
    tag: 9.4.0-debian-12-r1
  auth:
    rootPassword: "mysql_password"
    database: "my_database"
    username: ""
    password: ""
    replicationUser: "replicator"
    replicationPassword: ""
    existingSecret: "mysql-secret"
    usePasswordFiles: true
  
  # Primary node configuration
  primary:
    name: primary
    persistence:
      enabled: true
      storageClass: "standard"
      size: 10Gi
    
    resources:
      requests:
        cpu: "250m"
        memory: "512Mi"
      limits:
        cpu: "500m"
        memory: "1Gi"
    
    podLabels:
      app: mysql
      project: ng-voice
    
    # Pod anti-affinity - spread pods across different nodes
    podAntiAffinityPreset: "hard"
    
    # Custom node affinity - require nodes with db-node label (Exists operator)
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: db-node
              operator: Exists
    
    service:
      type: ClusterIP
      ports:
        mysql: 3306
  
  # Secondary/Replica nodes configuration
  secondary:
    name: secondary
    replicaCount: 1
    
    persistence:
      enabled: true
      storageClass: "standard"
      size: 10Gi
    
    resources:
      requests:
        cpu: "250m"
        memory: "512Mi"
      limits:
        cpu: "500m"
        memory: "1Gi"
    
    podLabels:
      app: mysql
      project: ng-voice
    
    # Pod anti-affinity - spread pods across different nodes
    podAntiAffinityPreset: "hard"
    
    # Custom node affinity - require nodes with db-node label (Exists operator)
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: db-node
              operator: Exists
    
    service:
      type: ClusterIP
      ports:
        mysql: 3306
  
  # Metrics exporter (optional)
  metrics:
    enabled: false
  
  # Disable Bitnami's network policy - we use custom one
  networkPolicy:
    enabled: false
  
  # Service account
  serviceAccount:
    create: true
    name: mysql-sa
  
  # Volume permissions
  volumePermissions:
    enabled: true
    image:
      repository: bitnamilegacy/os-shell

# Backup configuration (kept for custom backup jobs)
backup:
  enabled: true
  pvc:
    name: mysql-backup
    storageClass: "standard"
    size: 2Gi
  
  internal:
    enabled: true
    schedule: "*/30 * * * *"
    image:
      repository: mysql
      tag: "8.0"
    retention: "50"
  
  s3:
    enabled: false
    schedule: "0 3 * * *"
    bucket: "farhaan-shamsee-ng-voice-backups"
    region: "us-east-1"
    image:
      repository: amazon/aws-cli
      tag: "latest"
    awsSecretName: aws-credentials

# Web Server Configuration
webServer:
  enabled: true
  name: web-server
  replicas: 3
  
  image:
    repository: nginx
    tag: "latest"
    pullPolicy: IfNotPresent
  
  initContainer:
    image:
      repository: busybox
      tag: "latest"
  
  service:
    name: web-server
    type: NodePort
    port: 80
    targetPort: 80
    nodePort: 30090
    sessionAffinity: None
  
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "200m"
      memory: "256Mi"
  
  labels:
    app: web-server
    access: mysql-client
    project: ng-voice
  
  nginx:
    config: |
      worker_processes 1;
      events { worker_connections 1024; }
      http {
        server {
          listen 80;
          location / {
            root /usr/share/nginx/html;
            index index.html;
          }
          add_header X-Served-By $hostname always;
        }
      }
  
  readinessProbe:
    enabled: true
    httpGet:
      path: /
      port: 80
    initialDelaySeconds: 5
    periodSeconds: 10

# Network Policy Configuration
networkPolicy:
  enabled: true
  database:
    name: db-allow-web-only
    allowFrom:
      namespace: web-server # Namespace to allow traffic from
      podLabel: mysql-client # The Pod should be labelled as access=mysql-client

# Secondary Network (Multus)
secondaryNetwork:
  enabled: true
  name: secondary-network
  type: bridge
  bridge: br1
  ipam:
    type: host-local
    subnet: 192.168.50.0/24
    rangeStart: 192.168.50.100
    rangeEnd: 192.168.50.200
    gateway: 192.168.50.1
    routes:
      - dst: 0.0.0.0/0

# Pod Watcher (Go Application)
podWatcher:
  enabled: true
  name: pod-watcher
  namespace: default
  replicas: 1
  
  image:
    repository: farhaanshamsee/pod-watcher
    tag: "v2.0"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "100m"
      memory: "128Mi"
  
  serviceAccount:
    create: true
    name: pod-watcher
  
  rbac:
    create: true
    clusterRole:
      name: pod-watcher
    clusterRoleBinding:
      name: pod-watcher
